//ceebox
/*
 * CeeBox 2.0.0 beta jQuery Plugin (minimized version)
 * Requires jQuery 1.3.2 and swfobject.jquery.js plugin to work
 * Code hosted on GitHub (http://github.com/catcubed/ceebox) Please visit there for version history information
 * By Colin Fahrion (http://www.catcubed.com)
 * Inspiration for ceebox comes from Thickbox (http://jquery.com/demo/thickbox/) and Videobox (http://videobox-lb.sourceforge.net/)
 * However, along the upgrade path ceebox has morphed a long way from those roots.
 * Copyright (c) 2009 Colin Fahrion
 * Licensed under the MIT License: http://www.opensource.org/licenses/mit-license.php
*/

(function(e){e.ceebox={version:"2.0.0 beta"};e.fn.ceebox=function(s){s=e.extend({selector:e(this).selector},e.fn.ceebox.defaults,s);e(this).each(function(t){e.ceebox(this,t,s)});return this};e.fn.ceebox.defaults={html:true,image:true,video:true,modal:false,htmlGallery:true,imageGallery:true,videoGallery:true,videoWidth:false,videoHeight:false,videoRatio:"16:9",htmlWidth:false,htmlHeight:false,htmlRatio:false,imageWidth:false,imageHeight:false,animSpeed:"normal",easing:"swing",overlayColor:"#000",overlayOpacity:0.8,padding:15,border:"4px solid #525252",margin:150,onload:null,};e.fn.ceebox.ratios={"4:3":1.667,"3:2":1.5,"16:9":1.778,"1:1":1,square:1};e.fn.ceebox.relMatch={width:/\bwidth:[0-9]+\b/i,height:/\bheight:[0-9]+\b/i,modal:/\bmodal:true|false\b/i};e.ceebox=function(u,z,v){v=e.meta?e.extend({},v,e(u).data()):v;var t=e(u).contents().andSelf().find("[href]");var y=[],s=0;t.each(function(B){var A=this;e.each(d,function(D){if(d[D](e(A).attr("href"),v)){var C=A;v=e.meta?e.extend({},v,e(C).data()):v;if(v.htmlGallery==true&&D=="html"){y[s]=B;s++}if(v.imageGallery==true&&D=="image"){y[s]=B;s++}if(v.videoGallery==true&&D=="video"){y[s]=B;s++}e(C).bind("click",function(F){F.preventDefault();F.stopPropagation();e.fn.ceebox.overlay();if(D=="image"){var E=new Image();E.onload=function(){var G=E.width,H=E.height;v.imageWidth=e.fn.ceebox.defaults.imageWidth;v.imageHeight=e.fn.ceebox.defaults.imageHeight;v.imageWidth=c(G,e.fn.ceebox.defaults.imageWidth);v.imageHeight=c(H,e.fn.ceebox.defaults.imageHeight);v.imageRatio=G/H;e.fn.ceebox.popup(C,e.extend(v,{type:D}))};E.src=e(C).attr("href")}else{e.fn.ceebox.popup(C,e.extend(v,{type:D}))}});return false}})});var x=y.length;e.each(y,function(C){var B=t[y[C]];if(x>1){var A={parentId:z,cbId:C,cbLen:x};if(C>0){A.prevId=y[C-1]}if(C<x-1){A.nextId=y[C+1]}e.data(B,"ceebox",A)}})};var d={image:function(s,t){return(t.image)&&s.match(/\.jpg$|\.jpeg$|\.png$|\.gif$|\.bmp$/i)||false},video:function(s,t){return(t.video)&&s.match(i)||false},html:function(s,t){return(t.html)}};e.fn.ceebox.overlay=function(t){t=e.extend({width:60,height:30,type:"html"},e.fn.ceebox.defaults,t);var s=Number((t.border.match(/[0-9]+/g)[0]))||0;var v=parseInt(-1*((t.width)/2+s),10);var u=parseInt(-1*((t.height)/2+s),10);var y="fixed";if(e.browser.opera){if(e("#lameoperahack")===null){e("body").append("<span style='line-height:0px;color:rgba(0,0,0,0)' id='lameoperahack'>-</span>")}}if(typeof document.body.style.maxHeight==="undefined"){if(e("#cee_HideSelect")===null){e("body").append("<iframe id='cb.HideSelect'></iframe>")}var y="absolute";var x=document.documentElement&&document.documentElement.scrollTop||document.body.scrollTop;u=u+parseInt((x),10)}if(e("#cee_overlay").size()==0){e("<div id='cee_overlay'></div>").css({opacity:t.overlayOpacity,position:"absolute",top:0,left:0,backgroundColor:t.overlayColor,width:"100%",height:e(document).height(),zIndex:100}).appendTo(e("body")).click(function(z){l();return false})}if(e("#cee_box").size()==0){e("<div id='cee_box'></div>").addClass("cee_"+t.type).css({position:y,zIndex:102,top:"50%",left:"50%",height:t.height+"px",width:t.width+"px",marginLeft:v+"px",marginTop:u+"px",opacity:0,border:t.border}).appendTo("body").animate({height:t.height+"px",width:t.width+"px",opacity:1},t.animSpeed);e("<div id='cee_load'></div>").css({zIndex:105,top:"50%",left:"50%",position:"fixed"}).appendTo("body")}else{e("#cee_box").removeClass().addClass("cee_"+t.type)}e("#cee_load").show("fast").animate({opacity:1},"fast");this.top=u;this.left=v;return this};e.fn.ceebox.popup=function(x,v){v=e.extend({width:j(v.margin).width,height:j(v.margin).height,titleHeight:40,modal:false,type:"html",onload:null},e.fn.ceebox.defaults,v);var t,u;if(e(x).is("a,area,input")){t=e.data(x,"ceebox");if(t){u=e(v.selector).eq(t.parentId).contents().andSelf().find("[href]")}g.prototype=new q[v.type](v);f.prototype=new g(x,v);o[v.type].prototype=new f();var s=new o[v.type];x=s.content;v.width=s.width;v.height=s.height;v.action=s.action;v.modal=s.modal;v.titleHeight=e(s.titlebox).contents().contents().wrap("<div></div>").parent().attr("id","ceetitletest").css({position:"absolute",top:"-300px",width:(v.width-60)+"px"}).appendTo("body").height();e("#ceetitletest").remove();v.titleHeight=(v.titleHeight>=10)?v.titleHeight+20:30;v.width=s.width+2*v.padding;v.height=s.height+v.titleHeight+2*v.padding}var y=e.fn.ceebox.overlay(v);if(e("#cee_load").size()==0){e("<div id='cee_load'></div>").css({zIndex:105,top:"50%",left:"50%",position:"fixed"}).appendTo("body").show("fast")}e("#cee_box").animate({marginLeft:y.left,marginTop:y.top,width:v.width+"px",height:v.height+"px"},v.animSpeed,v.easing,function(){e(this).append(x).children().hide().fadeIn(400);if(v.modal=="true"){e("#cee_overlay").unbind()}else{e("#cee_title").prepend("<a href='#' id='cee_closeBtn' title='Close'>close</a>");e("#cee_closeBtn").click(function(z){l();return false});if(t){m(t,u,v)}k(t,u)}e("#cee_load").hide(300).animate({opacity:0},600);if(b(v.action)){v.action()}if(b(v.onload)){v.onload()}});e(".cee_close").live("click",function(z){z.preventDefault();l()})};var q={image:function(s){this.width=s.imageWidth;this.height=s.imageHeight;this.ratio=s.imageRatio;return this},video:function(s){this.width=s.videoWidth;this.height=s.videoHeight;this.ratio=s.videoRatio;return this},html:function(s){this.width=s.htmlWidth;this.height=s.htmlHeight;this.ratio=s.htmlRatio;return this}};var g=function(u,v){this.rel=e(u).attr("rel");this.href=e(u).attr("href");this.title=e(u).attr("title");this.titlebox="<div id='cee_title'><h2>"+this.title+"</h2></div>";this.margin=v.margin;this.modal=v.modal;var t=this.rel;if(t&&t!=""){var s=[String(t.match(e.fn.ceebox.relMatch.modal)),String(t.match(e.fn.ceebox.relMatch.width)),String(t.match(e.fn.ceebox.relMatch.height))];if(s[0]){this.modal=s[0].match(/true|false/i)}if(s[1]){this.width=Number(s[1].match(/[0-9]+\b/))}if(s[2]){this.height=Number(s[2].match(/[0-9]+\b/))}}return this};var f=function(){var s=j(this.margin);w=c(this.width,s.width);h=c(this.height,s.height);r=this.ratio;if(r){if(!Number(r)){e.each(e.fn.ceebox.ratios,function(t,u){if(r==t){r=u;return false}});r=Number(r)||1}if(w/h>r){w=parseInt(h*r,10)}if(w/h<r){h=parseInt(w/r,10)}}this.width=w;this.height=h;return this};var j=function(s){var t=document.documentElement;s=s||100;this.width=(window.innerWidth||self.innerWidth||(t&&t.clientWidth)||document.body.clientWidth)-s;this.height=(window.innerHeight||self.innerHeight||(t&&t.clientHeight)||document.body.clientHeight)-s;this.ratio=this.width/this.height;return this};var o={image:function(){this.type="image";this.content="<img id='cee_img' src='"+this.href+"' width='"+this.width+"' height='"+this.height+"' alt='"+this.title+"'/>"+this.titlebox;return this},video:function(){var z=n(this.href,this.title,this.rel);var v=z.src;var y=z.params;var x=z.flashvars;var t=this.width;var u=this.height;this.type="video";this.action=function(){e("#cee_vid").flash({swf:v,params:y,flashvars:x,width:t,height:u})};this.content="<div id='cee_vid' style='width:"+this.width+"px;height:"+this.height+"px'></div>"+this.titlebox;return this},html:function(){var u=this.href,v=this.rel;var t=[u.match(/\w+\.com/i),u.match(/^http:+/),(v)?v.match(/^iframe/):false];this.type="html";if((document.domain==t[0]&&t[1]&&!t[2])||(!t[1]&&!t[2])){var s=u;if(u.match(/#[a-z_A-Z1-9]+/)){var s=s+" "+u.match(/#[a-z_A-Z1-9]+/)}this.action=function(){e("#cee_ajax").load(s)};this.content=this.titlebox+"<div id='cee_ajax' style='width:"+(this.width-30)+"px;height:"+(this.height-20)+"px'></div>"}else{e("#cee_iframe").remove();this.content=this.titlebox+"<iframe frameborder='0' hspace='0' src='"+u+"' id='cee_iframeContent' name='cee_iframeContent"+Math.round(Math.random()*1000)+"'  style='width:"+(this.width)+"px;height:"+(this.height)+"px;' > </iframe>"}return this}};var i=/youtube\.com\/watch|metacafe\.com\/watch|google\.com\/videoplay|ifilm\.com\/video|vimeo\.com|dailymotion\.com|facebook\.com\/video|\.swf$/i;function n(y,v,z){var u=String(String(y.match(/\w+\.com/i)).match(/\w+/i));var x,B,A;B={wmode:"transparent",allowFullScreen:"true",allowScriptAccess:"always"};A={autoplay:true};x=String(y.match(/http:\/\/[a-zA-Z\.]+\.com/));switch(u){case"facebook":x=x+"/v/"+y.split("v=")[1].split("&")[0];B=e.extend({movie:x},B);break;case"youtube":x=x+"/v/"+y.split("v=")[1].split("&")[0]+"&hl=en&fs=1&autoplay=1";break;case"metacafe":x=x+"/fplayer/"+y.split("id=")[1].split("&")[0]+"/.swf";break;case"google":x=x+"/googleplayer.swf?docId="+y.split("id=")[1].split("&")[0]+"&hl=en";A=e.extend({playerMode:"normal",fs:true},A);break;case"ifilm":x=x+"/efp";A=e.extend({flvbaseclip:y.split("id=")[1].split("&")[0]+"&"});break;case"vimeo":x=x+"/moogaloop.swf?clip_id="+y.split("/")[3]+"&server=vimeo.com&show_title=1&show_byline=1&show_portrait=0&color=&fullscreen=1";break;case"dailymotion":x=x+"/swf/"+y.split("/")[4]+"&related=0&autoplay=1";break;default:x=y;break}this.src=x;this.params=B;this.flashvars=A;return this}function l(){e("#cee_closeBtn").unbind("click");e("#cee_box").fadeOut(600,function(){e("#cee_box,#cee_overlay,#cee_HideSelect").unbind().trigger("unload").remove()});e("#cee_overlay").fadeOut(1200);e("#cee_load").remove();document.onkeydown=null;document.onkeyup=null;return false}function k(t,s){document.onkeydown=function(v){v=v||window.event;var u=v.keyCode||v.which;switch(u){case 27:l();document.onkeydown=null;break;case 188:case 37:if(t&&t.prevId!=null){e("#cee_box").children().remove();document.onkeydown=null;s.eq(t.prevId).trigger("click")}break;case 190:case 39:if(t&&t.nextId){e("#cee_box").children().remove();document.onkeydown=null;s.eq(t.nextId).trigger("click")}break}}}function m(y,x,s){var A="px";var B="<div id='cee_count'>Item "+(y.cbId+1)+" of "+y.cbLen+"</div>";var z=parseInt(s.width/2);var u=s.height-s.titleHeight-2*s.padding;var v=s.padding;var t=u/2;if(s.type=="video"||s.type=="html"){z=60;u=80;v=parseInt((s.height-s.titleHeight-2*s.padding-10)/2);t=24}if(s.type=="html"){v=parseInt((s.height-s.titleHeight-10)/2)}$navLink=e("<a href='#'></a>").css({width:z+A,height:u+A,position:"absolute",top:v});if(y.prevId!=null){$navLink.clone().text("Prev").attr("id","cee_prev").css({left:"0px",backgroundPosition:"left "+(t-2000)+A}).hover(function(){e(this).css({backgroundPosition:"left "+t+A})},function(){e(this).css({backgroundPosition:"left "+(t-2000)+A})}).bind("click",function(C){a(C,y.prevId)}).appendTo("#cee_box")}if(y.nextId){$navLink.clone().text("Next").attr("id","cee_next").css({right:"0px",backgroundPosition:"right "+(t-2000)+A}).hover(function(){e(this).css({backgroundPosition:"right "+t+A})},function(){e(this).css({backgroundPosition:"right "+(t-2000)+A})}).bind("click",function(C){a(C,x,y.nextId)}).appendTo("#cee_box")}e("#cee_title").append(B)}function a(t,s,u){t.preventDefault();e("#cee_box").children().remove();s.eq(u).trigger("click")}function c(t,s){return((t&&t<s)||!s)?t:s}function p(s){return(typeof s=="object"&&s)||b(s)}function b(s){return typeof s=="function"}})(jQuery);