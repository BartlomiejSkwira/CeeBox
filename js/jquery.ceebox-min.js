//ceebox
/*
 * CeeBox 2.0.2 jQuery Plugin (minimized version using Google Closure compiler http://closure-compiler.appspot.com/home)
 * Requires jQuery 1.3.2 and swfobject.jquery.js plugin to work
 * Code hosted on GitHub (http://github.com/catcubed/ceebox) Please visit there for version history information
 * By Colin Fahrion (http://www.catcubed.com)
 * Inspiration for ceebox comes from Thickbox (http://jquery.com/demo/thickbox/) and Videobox (http://videobox-lb.sourceforge.net/)
 * However, along the upgrade path ceebox has morphed a long way from those roots.
 * Copyright (c) 2009 Colin Fahrion
 * Licensed under the MIT License: http://www.opensource.org/licenses/mit-license.php
*/

(function(b){b.ceebox={version:"2.0.2"};b.fn.ceebox=function(a){a=b.extend({selector:b(this).selector},b.fn.ceebox.defaults,a);b(this).each(function(c){b.ceebox(this,c,a)});return this};b.fn.ceebox.defaults={html:true,image:true,video:true,modal:false,htmlGallery:true,imageGallery:true,videoGallery:true,videoWidth:false,videoHeight:false,videoRatio:"16:9",htmlWidth:false,htmlHeight:false,htmlRatio:false,imageWidth:false,imageHeight:false,animSpeed:"normal",easing:"swing",fadeOut:400,fadeIn:400,overlayColor:"#000",
overlayOpacity:0.8,padding:15,borderWidth:"3px 3px 3px 3px",margin:150,onload:null};b.fn.ceebox.ratios={"4:3":1.667,"3:2":1.5,"16:9":1.778,"1:1":1,square:1};b.fn.ceebox.relMatch={width:/\bwidth:[0-9]+\b/i,height:/\bheight:[0-9]+\b/i,modal:/\bmodal:true|false\b/i};b.fn.ceebox.loader="<div id='cee_load' style='z-index:105;top:50%;left:50%;position:fixed'></div>";b.ceebox=function(a,c,d){var e,f=[],i=0;b(a).is("a[href],area[href],input[href]")?(e=b(a)):(e=b(a).children().andSelf().find("a[href],area[href],input[href]"));
var l={image:function(g,k){return k.image&&g.match(/\.jpg$|\.jpeg$|\.png$|\.gif$|\.bmp$/i)||false},video:function(g,k){return k.video&&g.match(E)||false},html:function(g,k){return k.html}};e.each(function(g){var k=this,j=b.metadata?b.extend({},d,b(k).metadata()):d;b.each(l,function(m){if(l[m](b(k).attr("href"),j)){var p=k;if(d.htmlGallery==true&&m=="html"){f[i]=g;i++}if(d.imageGallery==true&&m=="image"){f[i]=g;i++}if(d.videoGallery==true&&m=="video"){f[i]=g;i++}b(p).unbind("click").bind("click",function(q){q.preventDefault();
q.stopPropagation();b.fn.ceebox.overlay();if(m=="image"){var n=new Image;n.onload=function(){var y=n.width,z=n.height;j.imageWidth=s(y,b.fn.ceebox.defaults.imageWidth);j.imageHeight=s(z,b.fn.ceebox.defaults.imageHeight);j.imageRatio=y/z;b.fn.ceebox.popup(p,b.extend(j,{type:m}))};n.src=b(p).attr("href")}else b.fn.ceebox.popup(p,b.extend(j,{type:m}))});return false}})});var o=f.length;b.each(f,function(g){var k=e[f[g]];if(o>1){var j={parentId:c,cbId:g,cbLen:o};if(g>0)j.prevId=f[g-1];if(g<o-1)j.nextId=
f[g+1];b.data(k,"ceebox",j)}})};b.fn.ceebox.overlay=function(a){a=b.extend({width:60,height:30,type:"html"},b.fn.ceebox.defaults,a);var c,d,e=a.borderWidth.match(/[0-9]+/g);if(e.length=1)d=c=Number(e);else if(e.length=4){d=Number(e[0]);c=Number(e[3])}c=parseInt(-1*(a.width/2+c),10);d=parseInt(-1*(a.height/2+d),10);e="fixed";if(typeof document.body.style.maxHeight==="undefined"){b("#cee_HideSelect")===null&&b("body").append("<iframe id='cb.HideSelect'></iframe>");e="absolute";var f=document.documentElement&&
document.documentElement.scrollTop||document.body.scrollTop;d+=parseInt(f,10)}b("#cee_overlay").size()==0&&b("<div id='cee_overlay'></div>").css({opacity:a.overlayOpacity,position:"absolute",top:0,left:0,backgroundColor:a.overlayColor,width:"100%",height:b(document).height(),zIndex:100}).appendTo(b("body")).click(function(){t(a);return false});if(b("#cee_box").size()==0){b("<div id='cee_box'></div>").addClass("cee_"+a.type).css({position:e,zIndex:102,top:"50%",left:"50%",height:a.height+"px",width:a.width+
"px",marginLeft:c+"px",marginTop:d+"px",opacity:0,borderWidth:a.borderWidth}).appendTo("body").animate({height:a.height+"px",width:a.width+"px",opacity:1},a.animSpeed);b(b.fn.ceebox.loader).appendTo("body")}else b("#cee_box").removeClass().addClass("cee_"+a.type);b("#cee_load").show("fast").animate({opacity:1},"fast");this.top=d;this.left=c;return this};b.fn.ceebox.popup=function(a,c){c=b.extend({width:u(c.margin).width,height:u(c.margin).height,titleHeight:40,modal:false,type:"html",onload:null},
b.fn.ceebox.defaults,c);var d,e;if(b(a).is("a,area,input")&&(c.type=="html"||c.type=="image"||c.type=="video")){if(d=b.data(a,"ceebox"))e=b(c.selector).eq(d.parentId).contents().andSelf().find("[href]");A.prototype=new F[c.type](c);B.prototype=new A(a,c);C[c.type].prototype=new B;var f=new C[c.type];a=f.content;c.action=f.action;c.modal=f.modal;c.titleHeight=b(f.titlebox).contents().contents().wrap("<div></div>").parent().attr("id","ceetitletest").css({position:"absolute",top:"-300px",width:f.width+
"px"}).appendTo("body").height();b("#ceetitletest").remove();c.titleHeight=c.titleHeight>=10?c.titleHeight+20:30;c.width=f.width+2*c.padding;c.height=f.height+c.titleHeight+2*c.padding}f=b.fn.ceebox.overlay(c);b("#cee_load").size()==0&&b(b.fn.ceebox.loader).appendTo("body").show("fast");function i(){b("#cee_load").hide(300).fadeOut(600);D(c.action)&&c.action();D(c.onload)&&c.onload()}b("#cee_box").animate({marginLeft:f.left,marginTop:f.top,width:c.width+"px",height:c.height+"px"},c.animSpeed,c.easing,
function(){var l=b(this).append(a).children().hide(),o=l.length;l.fadeIn(c.fadeIn,function(){if(b(this).is("iframe")){b(this).load(function(){i()});var g=true}!g&&this==l[o-1]&&i()});if(c.modal==true)b("#cee_overlay").unbind();else{b("<a href='#' id='cee_closeBtn' title='Close'>close</a>").prependTo("#cee_box").one("click",function(){t(c);return false});d&&G(d,e,c);H(d,e,c)}});b(".cee_close").live("click",function(l){l.preventDefault();b(".cee_close").die();t(c)})};var F={image:function(a){this.width=
a.imageWidth;this.height=a.imageHeight;this.ratio=a.imageRatio;return this},video:function(a){this.width=a.videoWidth;this.height=a.videoHeight;this.ratio=a.videoRatio;return this},html:function(a){this.width=a.htmlWidth;this.height=a.htmlHeight;this.ratio=a.htmlRatio;return this}};function A(a,c){this.rel=b(a).attr("rel");this.href=b(a).attr("href");this.title=b(a).attr("title");this.titlebox="<div id='cee_title'><h2>"+this.title+"</h2></div>";this.margin=c.margin;this.modal=c.modal;if((a=this.rel)&&
a!=""){a=[String(a.match(b.fn.ceebox.relMatch.modal)),String(a.match(b.fn.ceebox.relMatch.width)),String(a.match(b.fn.ceebox.relMatch.height))];if(a[0])var d=a[0].match(/true|false/i);if(d=="true")this.modal=true;if(d=="false")this.modal=false;if(a[1])this.width=Number(a[1].match(/[0-9]+\b/));if(a[2])this.height=Number(a[2].match(/[0-9]+\b/))}return this}function B(){var a=u(this.margin);w=s(this.width,a.width);h=s(this.height,a.height);if(r=this.ratio){if(!Number(r)){b.each(b.fn.ceebox.ratios,function(c,
d){if(r==c){r=d;return false}});r=Number(r)||1}if(w/h>r)w=parseInt(h*r,10);if(w/h<r)h=parseInt(w/r,10)}this.width=w;this.height=h;return this}function u(a){var c=document.documentElement;a=a||100;this.width=(window.innerWidth||self.innerWidth||c&&c.clientWidth||document.body.clientWidth)-a;this.height=(window.innerHeight||self.innerHeight||c&&c.clientHeight||document.body.clientHeight)-a;this.ratio=this.width/this.height;return this}var C={image:function(){this.type="image";this.content="<img id='cee_img' src='"+
this.href+"' width='"+this.width+"' height='"+this.height+"' alt='"+this.title+"'/>"+this.titlebox;return this},video:function(){var a=I(this.href,this.title,this.rel),c=a.src,d=a.params,e=a.flashvars,f=this.width,i=this.height;this.type="video";this.action=function(){b("#cee_vid").flash({swf:c,params:d,flashvars:e,width:f,height:i})};this.content="<div id='cee_vid' style='width:"+this.width+"px;height:"+this.height+"px'></div>"+this.titlebox;return this},html:function(){var a=this.href,c=this.rel;
c=[a.match(/\w+\.com/i),a.match(/^http:+/),c?c.match(/^iframe/):false];this.type="html";if(document.domain==c[0]&&c[1]&&!c[2]||!c[1]&&!c[2]){var d=a;if(a.match(/#[a-z_A-Z1-9]+/)){d=a.split("#")[0];d=String(d+" "+a.match(/#[a-z_A-Z1-9\-]+/))}this.action=function(){b("#cee_ajax").load(d)};this.content=this.titlebox+"<div id='cee_ajax' style='width:"+(this.width-30)+"px;height:"+(this.height-20)+"px'></div>"}else{b("#cee_iframe").remove();this.content=this.titlebox+"<iframe frameborder='0' hspace='0' src='"+
a+"' id='cee_iframeContent' name='cee_iframeContent"+Math.round(Math.random()*1000)+"'  style='width:"+this.width+"px;height:"+this.height+"px;' > </iframe>"}return this}},E=/youtube\.com\/watch|metacafe\.com\/watch|google\.com\/videoplay|ifilm\.com\/video|vimeo\.com|dailymotion\.com|facebook\.com\/video|\.swf$/i;function I(a){var c=String(String(a.match(/\w+\.com/i)).match(/\w+/i)),d,e,f;e={wmode:"transparent",allowFullScreen:"true",allowScriptAccess:"always"};f={autoplay:true};d=String(a.match(/http:\/\/[a-zA-Z\.]+\.com/));
switch(c){case "facebook":d=d+"/v/"+a.split("v=")[1].split("&")[0];e=b.extend({movie:d},e);break;case "youtube":d=d+"/v/"+a.split("v=")[1].split("&")[0]+"&hl=en&fs=1&autoplay=1";break;case "metacafe":d=d+"/fplayer/"+a.split("id=")[1].split("&")[0]+"/.swf";break;case "google":d=d+"/googleplayer.swf?docId="+a.split("id=")[1].split("&")[0]+"&hl=en";f=b.extend({playerMode:"normal",fs:true},f);break;case "ifilm":d+="/efp";f=b.extend({flvbaseclip:a.split("id=")[1].split("&")[0]+"&"});break;case "vimeo":d=
d+"/moogaloop.swf?clip_id="+a.split("/")[3]+"&server=vimeo.com&show_title=1&show_byline=1&show_portrait=0&color=&fullscreen=1";break;case "dailymotion":d=d+"/swf/"+a.split("/")[4]+"&related=0&autoplay=1";break;default:d=a;break}this.src=d;this.params=e;this.flashvars=f;return this}function t(a){b("#cee_closeBtn").unbind();b("#cee_box").fadeOut(a.fadeOut,function(){b("#cee_box,#cee_overlay,#cee_HideSelect").unbind().trigger("unload").remove()});b("#cee_overlay").fadeOut(a.fadeOut*2);b("#cee_load").remove();
document.onkeydown=null;document.onkeyup=null;return false}function H(a,c,d){document.onkeydown=function(e){e=e||window.event;var f=e.keyCode||e.which;switch(f){case 27:t(d);document.onkeydown=null;break;case 188:case 37:a&&a.prevId!=null&&v(e,c,a.prevId,d);break;case 190:case 39:a&&a.nextId!=null&&v(e,c,a.nextId,d);break}}}function G(a,c,d){var e=parseInt(d.width/2),f=d.height-d.titleHeight-2*d.padding,i=d.padding,l=f/2;if(d.type=="video"||d.type=="html"){e=60;f=80;i=parseInt((d.height-d.titleHeight-
2*d.padding-10)/2);l=24}if(d.type=="html")i=parseInt((d.height-d.titleHeight-10)/2);function o(g,k){var j,m=l-2000+"px",p=l+"px";g=="prev"?(j=[{left:0},"left"]):(j=[{right:0},x="right"]);function q(n){return b.extend({width:e+"px",height:f+"px",position:"absolute",top:i},j[0],{backgroundPosition:j[1]+" "+n})}b("<a href='#'></a>").text(g).attr("id","cee_"+g).css(q(m)).hover(function(){b(this).css(q(p))},function(){b(this).css(q(m))}).one("click",function(n){v(n,c,k,d)}).appendTo("#cee_box")}a.prevId!=
null&&o("prev",a.prevId);a.nextId&&o("next",a.nextId);b("#cee_title").append("<div id='cee_count'>Item "+(a.cbId+1)+" of "+a.cbLen+"</div>")}function v(a,c,d,e){a.preventDefault();b("#cee_box").children().fadeOut(e.fadeOut,function(){b(this).remove();b(this).is("[id=cee_title]")&&c.eq(d).trigger("click")})}function s(a,c){return a&&a<c||!c?a:c}function D(a){return typeof a=="function"}})(jQuery);