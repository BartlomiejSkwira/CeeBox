//ceebox
/*
 * CeeBox 2.0.0 alpha jQuery Plugin
 * Requires jQuery 1.3.2 and swfobject.jquery.js plugin to work
 * Code hosted on GitHub (http://github.com/catcubed/ceebox) Please visit there for version history information
 * By Colin Fahrion (http://www.catcubed.com)
 * Inspiration for ceebox comes from Thickbox (http://jquery.com/demo/thickbox/) and Videobox (http://videobox-lb.sourceforge.net/)
 * However, along the upgrade path ceebox has morphed a long way from those roots.
 * Copyright (c) 2009 Colin Fahrion
 * Licensed under the MIT License: http://www.opensource.org/licenses/mit-license.php
*/

(function(e){e.ceebox={version:"2.0.0 alpha"};e.fn.ceebox=function(t){t=e.extend({selector:e(this).selector},e.fn.ceebox.defaults,t);e(this).each(function(u){e.ceebox(this,u,t)});return this};e.fn.ceebox.defaults={html:true,image:true,video:true,modal:false,pageMargin:100,videoWidth:false,videoHeight:false,videoRatio:"16:9",htmlWidth:false,htmlHeight:false,htmlRatio:false,imageWidth:false,imageHeight:false,animSpeed:"normal",overlayColor:"#000",overlayOpacity:0.8,border:"4px solid #525252",onload:null,backwardsCompatible:false};e.fn.ceebox.ratios={"4:3":1.667,"3:2":1.5,"16:9":1.778,"1:1":1,square:1};e.fn.ceebox.relMatch={width:/\bwidth:[0-9]+\b/i,height:/\bheight:[0-9]+\b/i,modal:/\bmodal:true|false\b/i};e.ceebox=function(v,A,x){x=e.meta?e.extend({},x,e(v).data()):x;var u=e(v).contents().andSelf().find("[href]");var z=[],t=0;u.each(function(C){var B=this;e.each(d,function(D){if(d[D](e(B).attr("href"),x)){z[t]={alinkId:C,type:D};t++;return false}})});var y=z.length;e.each(z,function(D){var C=u[z[D].alinkId];var E=z[D].type;x=e.meta?e.extend({},x,e(C).data()):x;if(y>1){var B={parentId:A,cbId:D,cbLen:y};if(D>0){B.prevId=z[D-1].alinkId}if(D<y-1){B.nextId=z[D+1].alinkId}e.data(C,"ceebox",B)}e(C).bind("click",function(G){a(e(C).attr("href"));G.preventDefault();G.stopPropagation();e.fn.ceebox.overlay();if(E=="image"){var F=new Image();F.src=e(C).attr("href");F.onload=function(){var H=F.width,I=F.height;x.imageWidth=c(H,x.imageWidth);x.imageHeight=c(I,x.imageHeight);x.imageRatio=H/I;e.fn.ceebox.popup(C,e.extend(x,{type:E}))}}else{e.fn.ceebox.popup(C,e.extend(x,{type:E}))}})})};var d={image:function(t,u){return(u.image)&&t.match(/\.jpg$|\.jpeg$|\.png$|\.gif$|\.bmp$/i)||false},video:function(t,u){return(u.video)&&t.match(i)||false},html:function(t,u){return(u.html)}};function c(u,t){return(u&&u<t)?u:t}var s={image:function(t){this.width=t.imageWidth;this.height=t.imageHeight;this.ratio=t.imageRatio;return this},video:function(t){this.width=t.videoWidth;this.height=t.videoHeight;this.ratio=t.videoRatio;return this},html:function(t){this.width=t.htmlWidth;this.height=t.htmlHeight;this.ratio=t.htmlRatio;return this}};var g=function(v,x){this.rel=e(v).attr("rel");this.href=e(v).attr("href");this.title=e(v).attr("title");this.content="<div id='cee_title'><h2>"+this.title+"</h2></div>";this.margin=x.pageMargin;var u=this.rel;if(u&&u!=""){if(x.backwardsCompatible){var t=[u.match(/\bmodal\b/i),u.match(/\b[0-9]+\b/g),u.match(/\bwidth:[0-9]+\b/g)]}else{var t=[String(u.match(e.fn.ceebox.relMatch.modal)),String(u.match(e.fn.ceebox.relMatch.width)),String(u.match(e.fn.ceebox.relMatch.height))]}if(t[0]){(x.backwardsCompatible)?this.modal=true:this.modal=t[0].match(/true|false/i)}if(x.backwardsCompatible){if(t[1][0]){this.width=Number(r[1][0])}if(t[1][1]){this.height=Number(r[1][1])}}else{if(t[1]){this.width=Number(t[1].match(/[0-9]+\b/))}if(t[2]){this.height=Number(t[2].match(/[0-9]+\b/))}}}return this};var f=function(){var t=j(this.margin);w=c(this.width,t.width);h=c(this.height,t.height);r=this.ratio;if(r){if(!Number(r)){e.each(e.fn.ceebox.ratios,function(u,v){if(r==u){r=v;return false}});r=Number(r)||1}if(w/h>r){w=parseInt(h*r,10)}if(w/h<r){h=parseInt(w/r,10)}}this.width=w;this.height=h;return this};var o={image:function(){this.type="image";this.content="<img id='cee_img' src='"+this.href+"' width='"+this.width+"' height='"+this.height+"' alt='"+this.title+"'/>"+this.content;return this},video:function(){var z=n(this.href,this.title,this.rel);var v=z.src;var y=z.params;var x=z.flashvars;var t=this.width;var u=this.height;this.type="video";this.action=function(){e("#cee_vid").flash({swf:v,params:y,flashvars:x,width:t,height:u})};this.content="<div id='cee_vid' style='width:"+this.width+"px;height:"+this.height+"px'></div>"+this.content;return this},html:function(){var v=this.href,x=this.rel;var u=[v.match(/\w+\.com/i),v.match(/^http:+/),(x)?x.match(/^iframe/):false];this.type="html";if((document.domain==u[0]&&u[1]&&!u[2])||(!u[1]&&!u[2])){var t=v;if(v.match(/#[a-z_A-Z1-9]+/)){var t=t+" "+v.match(/#[a-z_A-Z1-9]+/)}this.action=function(){e("#cee_ajax").load(t)};this.content=this.content+"<div id='cee_ajax' style='width:"+(this.width-30)+"px;height:"+(this.height-20)+"px'></div>"}else{e("#cee_iframe").remove();this.content=this.content+"<iframe frameborder='0' hspace='0' src='"+v+"' id='cee_iframeContent' name='cee_iframeContent"+Math.round(Math.random()*1000)+"'  style='width:"+(this.width)+"px;height:"+(this.height)+"px;' > </iframe>"}return this}};var j=function(t){var u=document.documentElement;t=t||100;this.width=(window.innerWidth||self.innerWidth||(u&&u.clientWidth)||document.body.clientWidth)-t;this.height=(window.innerHeight||self.innerHeight||(u&&u.clientHeight)||document.body.clientHeight)-t;this.ratio=this.width/this.height;return this};e.fn.ceebox.overlay=function(u){u=e.extend({width:60,height:30,type:"html"},e.fn.ceebox.defaults,u);var t=Number((u.border.match(/[0-9]+/g)[0]))||0;if(e.browser.opera){if(e("#lameoperahack")===null){e("body").append("<span style='line-height:0px;color:rgba(0,0,0,0)' id='lameoperahack'>-</span>")}}if(typeof document.body.style.maxHeight==="undefined"){if(e("#cee_HideSelect")===null){e("body").append("<iframe id='cb.HideSelect'></iframe>")}var z="absolute";var y=document.documentElement&&document.documentElement.scrollTop||document.body.scrollTop;var x=parseInt(-1*(u.height/2-y+t),10)}else{var z="fixed";var x=parseInt(-1*(u.height/2+t),10)}var v=parseInt(-1*(u.width/2+t),10);if(e("#cee_overlay").size()==0){e("<div id='cee_overlay'></div>").css({opacity:u.overlayOpacity,position:"absolute",top:0,left:0,backgroundColor:u.overlayColor,width:"100%",height:e(document).height(),zIndex:100}).appendTo(e("body"))}if(e("#cee_box").size()==0){e("<div id='cee_box'></div>").addClass("cee_"+u.type).css({position:z,zIndex:102,top:"50%",left:"50%",height:u.height+"px",width:u.width+"px",marginLeft:v+"px",marginTop:x+"px",opacity:0,border:u.border}).appendTo("body").animate({height:u.height+"px",width:u.width+"px",opacity:1},u.animSpeed);e("<div id='cee_load'></div>").css({zIndex:105,top:"50%",left:"50%",position:"fixed"}).appendTo("body").show("fast")}else{e("#cee_box").removeClass().addClass("cee_"+u.type)}this.top=x;this.left=v;return this};e.fn.ceebox.popup=function(x,v){v=e.extend({width:j(100).width,height:j(100).height,modal:false,type:"iframe",onload:null},e.fn.ceebox.defaults,v);if(e(x).is("a")){var u=e.data(x,"ceebox");g.prototype=new s[v.type](v);f.prototype=new g(x,v);o[v.type].prototype=new f();var t=new o[v.type];x=t.content;v.width=t.width+30;v.height=t.height+60;v.action=t.action;v.modal=t.modal}var y=e.fn.ceebox.overlay(v);e("#cee_box").css("background-image","none").animate({marginLeft:y.left,marginTop:y.top,height:v.height+"px",width:v.width+"px"},v.animSpeed,function(){e(this).append(x).children().fadeIn("fast");if(v.modal=="true"){e("#cee_overlay").unbind()}else{e("#cee_title").prepend("<a href='#' id='cee_closeBtn' title='Close'>close</a>");e("#cee_closeBtn, #cee_overlay").click(function(z){l();return false});if(u){m(u,v)}k()}e("#cee_load").hide("normal").animate({opacity:0},"slow");if(b(v.action)){v.action()}if(b(v.onload)){v.onload()}});e(".cee_close").live("click",function(z){z.preventDefault();l()})};function l(){e("#cee_closeBtn").unbind("click");e("#cee_box").fadeOut("fast",function(){e("#cee_box,#cee_overlay,#cee_HideSelect").unbind().trigger("unload").remove()});e("#cee_load").remove();document.onkeydown=null;document.onkeyup=null;return false}function q(t){typeof t=="number"&&isFinite(t)}function p(t){return(typeof t=="object"&&t)||b(t)}function b(t){return typeof t=="function"}function a(u,t){if(window.console&&window.console.log){var x="[ceebox]("+(t||"")+")";var v;if(e.isArray(u)||p(u)){e.each(u,function(y,z){v=v+y+":"+z+", "})}else{v=u}window.console.log(x+v)}}var i=/youtube\.com\/watch|metacafe\.com\/watch|google\.com\/videoplay|ifilm\.com\/video|vimeo\.com|dailymotion\.com|facebook\.com\/video|\.swf$/i;function n(y,v,z){var u=String(String(y.match(/\w+\.com/i)).match(/\w+/i));var x,B,A;B={wmode:"transparent",allowFullScreen:"true",allowScriptAccess:"always"};A={autoplay:true};x=String(y.match(/http:\/\/[a-zA-Z\.]+\.com/));switch(u){case"facebook":x=x+"/v/"+y.split("v=")[1].split("&")[0];B=e.extend({movie:x},B);break;case"youtube":x=x+"/v/"+y.split("v=")[1].split("&")[0]+"&hl=en&fs=1&autoplay=1";break;case"metacafe":x=x+"/fplayer/"+y.split("id=")[1].split("&")[0]+"/.swf";break;case"google":x=x+"/googleplayer.swf?docId="+y.split("id=")[1].split("&")[0]+"&hl=en";A=e.extend({playerMode:"normal",fs:true},A);break;case"ifilm":x=x+"/efp";A=e.extend({flvbaseclip:y.split("id=")[1].split("&")[0]+"&"});break;case"vimeo":x=x+"/moogaloop.swf?clip_id="+y.split("/")[3]+"&server=vimeo.com&show_title=1&show_byline=1&show_portrait=0&color=&fullscreen=1";break;case"dailymotion":x=x+"/swf/"+y.split("/")[4]+"&related=0&autoplay=1";break;default:x=y;break}this.src=x;this.params=B;this.flashvars=A;return this}function k(){document.onkeydown=function(u){u=u||window.event;var t=u.keyCode||u.which;switch(t){case 27:l();break;case 188:case 37:break;case 190:case 39:break}}}function m(C,t){a(C,"gallery");a(t.selector);var B,E,z,H,v;var A=e(t.selector).eq(C.parentId).contents().andSelf().find("[href]");var F="px";var G="<div id='cee_count'>Item "+(C.cbId+1)+" of "+C.cbLen+"</div>";var D=parseInt(t.width/2);var x=t.height-60;var y=0;var u=x/2;if(t.type=="video"||t.type=="html"){D=60;x=80;y=parseInt((t.height-60)/2);u=24}$navLink=e("<a href='#'></a>").css({width:D+F,height:x+F,position:"absolute",top:y});if(C.prevId!=null){$navLink.clone().text("Prev").attr("id","cee_prev").css({left:"0px",backgroundPosition:"left "+(u-2000)+F}).hover(function(){e(this).css({backgroundPosition:"left "+u+F})},function(){e(this).css({backgroundPosition:"left "+(u-2000)+F})}).bind("click",function(I){I.preventDefault();e("#cee_box").children().remove();A.eq(C.prevId).trigger("click")}).appendTo("#cee_box")}if(C.nextId){$navLink.clone().text("Next").attr("id","cee_next").css({right:"0px",backgroundPosition:"right "+(u-2000)+F}).hover(function(){e(this).css({backgroundPosition:"right "+u+F})},function(){e(this).css({backgroundPosition:"right "+(u-2000)+F})}).bind("click",function(I){I.preventDefault();e("#cee_box").children().remove();A.eq(C.nextId).trigger("click")}).appendTo("#cee_box")}e("#cee_title").append(G)}})(jQuery);