//ceebox
/*
 * CeeBox 2.1 jQuery Plugin (minimized version)
 * Requires jQuery 1.3.2 and swfobject.jquery.js plugin to work
 * Code hosted on GitHub (http://github.com/catcubed/ceebox) Please visit there for version history information
 * By Colin Fahrion (http://www.catcubed.com)
 * Inspiration for ceebox comes from Thickbox (http://jquery.com/demo/thickbox/) and Videobox (http://videobox-lb.sourceforge.net/)
 * However, along the upgrade path ceebox has morphed a long way from those roots.
 * Copyright (c) 2009 Colin Fahrion
 * Licensed under the MIT License: http://www.opensource.org/licenses/mit-license.php
*/

function(b){function v(c,a,d){l=new (function(){var g="";b.each(b.fn.ceebox.videos,function(e,h){if(h.siteRgx!=null&&typeof h.siteRgx!="string"){e=String(h.siteRgx);g=g+e.slice(1,e.length-2)+"|"}});this.vidRegex=new RegExp(g+"\\.swf$","i")});l.userAgent=navigator.userAgent;b(".cee_close").die().live("click",function(){b.fn.ceebox.closebox();return false});b(c).contents().is("html")||b(c).each(function(g){B(this,g,a,d)});b(c).live("click",function(g){var e=b(g.target).closest("[href]"),h=e.data("ceebox");
if(h){var i=h.opts?b.extend({},a,h.opts):a;b.fn.ceebox.overlay(i);if(h.type=="image"){var f=new Image;f.onload=function(){var k=f.width,j=f.height;i.imageWidth=s(k,b.fn.ceebox.defaults.imageWidth);i.imageHeight=s(j,b.fn.ceebox.defaults.imageHeight);i.imageRatio=k/j;b.fn.ceebox.popup(e,b.extend(i,{type:h.type},{gallery:h.gallery}))};f.src=b(e).attr("href")}else b.fn.ceebox.popup(e,b.extend(i,{type:h.type},{gallery:h.gallery}));return false}})}function w(c,a){c=c.match(a);a=[];var d=c.length;if(d>1){a[0]=
c[0];a[1]=c[1];a[2]=d==2?c[0]:c[2];a[3]=d==4?c[3]:c[1]}else a=[c,c,c,c];return a}function C(c,a,d){document.onkeydown=function(g){g=g||window.event;switch(g.keyCode||g.which){case 13:return false;case 27:b.fn.ceebox.closebox(d);document.onkeydown=null;break;case 188:case 37:c&&c.prevId!=null&&galleryNav(a,c.prevId,d);break;case 190:case 39:c&&c.nextId!=null&&galleryNav(a,c.nextId,d);break}}}function D(c,a,d){function g(k,j){var m,o=f[d.type].bgtop,r=o-2E3;k=="prev"?(m=[{left:0},"left"]):(m=[{right:0},
x="right"]);var n=function(p){return b.extend({zIndex:105,width:f[d.type].w+"px",height:f[d.type].h+"px",position:"absolute",top:f[d.type].top,backgroundPosition:m[1]+" "+p+"px"},m[0])};b("<a href='#'></a>").text(k).attr({id:"cee_"+k}).css(n(r)).hover(function(){b(this).css(n(o))},function(){b(this).css(n(r))}).one("click",function(p){p.preventDefault();(function(E,F,G){b("#cee_prev,#cee_next").unbind().click(function(){return false});document.onkeydown=null;var u=b("#cee_box").children(),H=u.length;
u.fadeOut(G,function(){b(this).remove();this==u[H-1]&&E.eq(F).trigger("click")})})(a,j,d.fadeOut)}).appendTo("#cee_box")}var e=d.height,h=d.titleHeight,i=d.padding,f={image:{w:parseInt(d.width/2),h:e-h-2*i,top:i,bgtop:(e-h-2*i)/2},video:{w:60,h:80,top:parseInt((e-h-10-2*i)/2),bgtop:24}};f.html=f.video;c.prevId!=null&&g("prev",c.prevId);c.nextId&&g("next",c.nextId);b("#cee_title").append("<div id='cee_count'>Item "+(c.gNum+1)+" of "+c.gLen+"</div>")}function s(c,a){return c&&c<a||!a?c:a}function t(c){return typeof c==
"function"}function q(c){var a=c.length;return a>1?c[a-1]:c}b.ceebox={version:"2.1"};b.fn.ceebox=function(c){c=b.extend({selector:b(this).selector},b.fn.ceebox.defaults,c);var a=this,d=b(this).selector;c.videoJSON?b.getJSON(c.videoJSON,function(g){b.extend(b.fn.ceebox.videos,g);v(a,c,d)}):v(a,c,d);return this};b.fn.ceebox.defaults={html:true,image:true,video:true,modal:false,titles:true,htmlGallery:true,imageGallery:true,videoGallery:true,videoWidth:false,videoHeight:false,videoRatio:"16:9",htmlWidth:false,
htmlHeight:false,htmlRatio:false,imageWidth:false,imageHeight:false,animSpeed:"normal",easing:"swing",fadeOut:400,fadeIn:400,overlayColor:"#000",overlayOpacity:0.8,boxColor:"",textColor:"",borderColor:"",borderWidth:"3px",padding:15,margin:150,onload:null,unload:null,videoJSON:null,iPhoneRedirect:true};b.fn.ceebox.ratios={"4:3":1.333,"3:2":1.5,"16:9":1.778,"1:1":1,square:1};b.fn.ceebox.relMatch={width:/(?:width:)([0-9]+)/i,height:/(?:height:)([0-9]+)/i,ratio:/(?:ratio:)([0-9\.:]+)/i,modal:/modal:true/i,
nonmodal:/modal:false/i,videoSrc:/(?:videoSrc:)(http:[\/\-\._0-9a-zA-Z:]+)/i,videoId:/(?:videoId:)([\-\._0-9a-zA-Z:]+)/i};b.fn.ceebox.loader="<div id='cee_load' style='z-index:105;top:50%;left:50%;position:fixed'></div>";b.fn.ceebox.videos={base:{param:{wmode:"transparent",allowFullScreen:"true",allowScriptAccess:"always"},flashvars:{autoplay:true}},facebook:{siteRgx:/facebook\.com\/video/i,idRgx:/(?:v=)([a-zA-Z0-9_]+)/i,src:"http://www.facebook.com/v/[id]"},youtube:{siteRgx:/youtube\.com\/watch/i,
idRgx:/(?:v=)([a-zA-Z0-9_\-]+)/i,src:"http://www.youtube.com/v/[id]&hl=en&fs=1&autoplay=1"},metacafe:{siteRgx:/metacafe\.com\/watch/i,idRgx:/(?:watch\/)([a-zA-Z0-9_]+)/i,src:"http://www.metacafe.com/fplayer/[id]/.swf"},google:{siteRgx:/google\.com\/videoplay/i,idRgx:/(?:id=)([a-zA-Z0-9_\-]+)/i,src:"http://video.google.com/googleplayer.swf?docId=[id]&hl=en&fs=true",flashvars:{playerMode:"normal",fs:true}},spike:{siteRgx:/spike\.com\/video|ifilm\.com\/video/i,idRgx:/(?:\/)([0-9]+)/i,src:"http://www.spike.com/efp",
flashvars:{flvbaseclip:"[id]"}},vimeo:{siteRgx:/vimeo\.com\/[0-9]+/i,idRgx:/(?:\.com\/)([a-zA-Z0-9_]+)/i,src:"http://www.vimeo.com/moogaloop.swf?clip_id=[id]&server=vimeo.com&show_title=1&show_byline=1&show_portrait=0&color=&fullscreen=1"},dailymotion:{siteRgx:/dailymotion\.com\/video/i,idRgx:/(?:video\/)([a-zA-Z0-9_]+)/i,src:"http://www.dailymotion.com/swf/[id]&related=0&autoplay=1"},cnn:{siteRgx:/cnn\.com\/video/i,idRgx:/(?:\?\/video\/)([a-zA-Z0-9_\/\.]+)/i,src:"http://i.cdn.turner.com/cnn/.element/apps/cvp/3.0/swf/cnn_416x234_embed.swf?context=embed&videoId=[id]",
width:416,height:374}};b.fn.ceebox.overlay=function(c){c=b.extend({width:60,height:30,type:"html"},b.fn.ceebox.defaults,c);b("#cee_overlay").size()==0&&b("<div id='cee_overlay'></div>").css({opacity:c.overlayOpacity,position:"absolute",top:0,left:0,backgroundColor:c.overlayColor,width:"100%",height:b(document).height(),zIndex:100}).appendTo(b("body"));if(b("#cee_box").size()==0){var a=y(c);a={position:a.position,zIndex:102,top:"50%",left:"50%",height:c.height+"px",width:c.width+"px",marginLeft:a.mleft+
"px",marginTop:a.mtop+"px",opacity:0,borderWidth:c.borderWidth,borderColor:c.borderColor,backgroundColor:c.boxColor,color:c.textColor};b("<div id='cee_box'></div>").css(a).appendTo("body").animate({opacity:1},c.animSpeed,function(){b("#cee_overlay").addClass("cee_close")})}b("#cee_box").removeClass().addClass("cee_"+c.type);b("#cee_load").size()==0&&b(b.fn.ceebox.loader).appendTo("body");b("#cee_load").show("fast").animate({opacity:1},"fast")};b.fn.ceebox.popup=function(c,a){var d=z(a.margin);a=b.extend({width:d.width,
height:d.height,modal:false,type:"html",onload:null},b.fn.ceebox.defaults,a);var g,e;if(b(c).is("a,area,input")&&(a.type=="html"||a.type=="image"||a.type=="video")){if(a.gallery)e=b(a.selector).eq(a.gallery.parentId).find("a[href],area[href],input[href]");A[a.type].prototype=new I(c,a);d=new A[a.type];c=d.content;a.action=d.action;a.modal=d.modal;if(a.titles){a.titleHeight=b(d.titlebox).contents().contents().wrap("<div></div>").parent().attr("id","ceetitletest").css({position:"absolute",top:"-300px",
width:d.width+"px"}).appendTo("body").height();b("#ceetitletest").remove();a.titleHeight=a.titleHeight>=10?a.titleHeight+20:30}else a.titleHeight=0;a.width=d.width+2*a.padding;a.height=d.height+a.titleHeight+2*a.padding}b.fn.ceebox.overlay(a);l.action=a.action;l.onload=a.onload;l.unload=a.unload;d=y(a);d={marginLeft:d.mleft,marginTop:d.mtop,width:a.width+"px",height:a.height+"px",borderWidth:a.borderWidth};if(a.borderColor){var h=w(a.borderColor,/#[1-90a-f]+/gi);d=b.extend(d,{borderTopColor:h[0],
borderRightColor:h[1],borderBottomColor:h[2],borderLeftColor:h[3]})}d=a.textColor?b.extend(d,{color:a.textColor}):d;d=a.boxColor?b.extend(d,{backgroundColor:a.boxColor}):d;b("#cee_box").animate(d,a.animSpeed,a.easing,function(){var i=b(this).append(c).children().hide(),f=i.length,k=true;i.fadeIn(a.fadeIn,function(){if(b(this).is("#cee_iframeContent"))k=false;k&&this==i[f-1]&&b.fn.ceebox.onload()});if(a.modal==true)b("#cee_overlay").removeClass("cee_close");else{b("<a href='#' id='cee_closeBtn' class='cee_close' title='Close'>close</a>").prependTo("#cee_box");
a.gallery&&D(a.gallery,e,a);C(g,e,a.fadeOut)}})};b.fn.ceebox.closebox=function(c,a){c=c||400;b("#cee_box").fadeOut(c);b("#cee_overlay").fadeOut(typeof c=="number"?c*2:"slow",function(){b("#cee_box,#cee_overlay,#cee_HideSelect,#cee_load").unbind().trigger("unload").remove();t(a)?a():t(l.unload)&&l.unload();l.unload=null});document.onkeydown=null};b.fn.ceebox.onload=function(){b("#cee_load").hide(300).fadeOut(600,function(){b(this).remove()});if(t(l.action)){l.action();l.action=null}if(t(l.onload)){l.onload();
l.onload=null}};var l,B=function(c,a,d){var g,e=[],h=[],i=0;b(c).is("[href]")?(g=b(c)):(g=b(c).find("[href]"));var f={image:function(j){return j.match(/\.jpg$|\.jpeg$|\.png$|\.gif$|\.bmp$/i)||false},video:function(j,m){return m&&m.match(/^video$/i)?true:j.match(l.vidRegex)||false},html:function(){return true}};g.each(function(j){var m=this,o=b.metadata?b(m).metadata():false,r=o?b.extend({},d,o):d;b.each(f,function(n){if(f[n](b(m).attr("href"),b(m).attr("rel"))&&r[n]){var p=false;if(d.htmlGallery==
true&&n=="html"||d.imageGallery==true&&n=="image"||d.videoGallery==true&&n=="video"){h[h.length]=j;p=true}e[e.length]={linkObj:m,type:n,gallery:p,linkOpts:r};return false}})});var k=h.length;b.each(e,function(j){if(e[j].gallery){var m={parentId:a,gNum:i,gLen:k};if(i>0)m.prevId=h[i-1];if(i<k-1)m.nextId=h[i+1];i++}!b.support.opacity&&b(c).is("map")&&b(e[j].linkObj).click(function(o){o.preventDefault()});b.data(e[j].linkObj,"ceebox",{type:e[j].type,opts:e[j].linkOpts,gallery:m})})},I=function(c,a){var d=
a.type,g={image:[a.imageWidth,a.imageHeight,a.imageRatio||a.imageWidth/a.imageHeight],video:[a.videoWidth,a.videoHeight,a.videoRatio],html:[a.htmlWidth,a.htmlHeight,a.htmlRatio]},e=g[d][0],h=g[d][1];d=g[d][2];var i=b(c).attr("rel");if(i&&i!=""){var f={};b.each(b.fn.ceebox.relMatch,function(k,j){f[k]=j.exec(i)});if(f.modal)a.modal=true;if(f.nonmodal)a.modal=false;if(f.width)e=Number(q(f.width));if(f.height)h=Number(q(f.height));if(f.ratio){d=q(f.ratio);d=Number(d)?Number(d):String(d)}if(f.videoSrc)this.videoSrc=
String(q(f.videoSrc));if(f.videoId)this.videoId=String(q(f.videoId))}g=z(a.margin);e=s(e,g.width);h=s(h,g.height);if(d){Number(d)||(d=b.fn.ceebox.ratios[d]?Number(b.fn.ceebox.ratios[d]):1);if(e/h>d)e=parseInt(h*d,10);if(e/h<d)h=parseInt(e/d,10)}this.modal=a.modal;this.href=b(c).attr("href");this.title=b(c).attr("title")||c.t||"";this.titlebox=a.titles?"<div id='cee_title'><h2>"+this.title+"</h2></div>":"";this.width=e;this.height=h;this.rel=i;this.iPhoneRedirect=a.iPhoneRedirect},A={image:function(){this.content=
"<img id='cee_img' src='"+this.href+"' width='"+this.width+"' height='"+this.height+"' alt='"+this.title+"'/>"+this.titlebox},video:function(){var c="",a=new (function(g){var e=this,h=g.videoId;e.flashvars=e.param={};e.src=g.videoSrc||g.href;e.width=g.width;e.height=g.height;b.each(b.fn.ceebox.videos,function(i,f){if(f.siteRgx!=null&&typeof f.siteRgx!="string"&&f.siteRgx.test(g.href)){if(f.idRgx){f.idRgx=new RegExp(f.idRgx);h=String(q(f.idRgx.exec(g.href)))}e.src=f.src?f.src.replace("[id]",h):e.src;
f.flashvars&&b.each(f.flashvars,function(k,j){if(typeof j=="string")e.flashvars[k]=j.replace("[id]",h)});f.param&&b.each(f.param,function(k,j){if(typeof j=="string")e.param[k]=j.replace("[id]",h)});e.width=f.width||e.width;e.height=f.height||e.height;e.site=i}})})(this);if(b.flash.hasVersion(8)){this.width=a.width;this.height=a.height;this.action=function(){b("#cee_vid").flash({swf:a.src,params:b.extend(b.fn.ceebox.videos.base.param,a.param),flashvars:b.extend(b.fn.ceebox.videos.base.flashvars,a.flashvars),
width:a.width,height:a.height})}}else{this.width=400;this.height=200;if(l.userAgent.match(/iPhone/i)&&this.iPhoneRedirect||l.userAgent.match(/iPod/i)&&this.iPhoneRedirect){var d=this.href;this.action=function(){b.fn.ceebox.closebox(400,function(){window.location=d})}}else{a.site=a.site||"SWF file";c="<p style='margin:20px'>Adobe Flash 8 or higher is required to view this movie. You can either:</p><ul><li>Follow link to <a href='"+this.href+"'>"+a.site+" </a></li><li>or <a href='http://www.adobe.com/products/flashplayer/'>Install Flash</a></li><li> or <a href='#' class='cee_close'>Close This Popup</a></li></ul>"}}this.content=
"<div id='cee_vid' style='width:"+this.width+"px;height:"+this.height+"px;'>"+c+"</div>"+this.titlebox},html:function(){var c=this.href,a=this.rel;a=[c.match(/[a-zA-Z0-9_\.]+\.[a-zA-Z]{2,4}/i),c.match(/^http:+/),a?a.match(/^iframe/):false];if(document.domain==a[0]&&a[1]&&!a[2]||!a[1]&&!a[2]){var d,g=(d=c.match(/#[a-zA-Z0-9_\-]+/))?String(c.split("#")[0]+" "+d):c;this.action=function(){b("#cee_ajax").load(g)};this.content=this.titlebox+"<div id='cee_ajax' style='width:"+(this.width-30)+"px;height:"+
(this.height-20)+"px'></div>"}else{b("#cee_iframe").remove();this.content=this.titlebox+"<iframe frameborder='0' hspace='0' src='"+c+"' id='cee_iframeContent' name='cee_iframeContent"+Math.round(Math.random()*1E3)+"' onload='jQuery.fn.ceebox.onload()' style='width:"+this.width+"px;height:"+this.height+"px;' > </iframe>"}}},z=function(c){var a=document.documentElement;c=c||100;this.width=(window.innerWidth||self.innerWidth||a&&a.clientWidth||document.body.clientWidth)-c;this.height=(window.innerHeight||
self.innerHeight||a&&a.clientHeight||document.body.clientHeight)-c;return this},y=function(c){var a="fixed",d=0,g=w(c.borderWidth,/[0-9]+/g);if(!window.XMLHttpRequest){b("#cee_HideSelect")===null&&b("body").append("<iframe id='cee_HideSelect'></iframe>");a="absolute";d=parseInt(document.documentElement&&document.documentElement.scrollTop||document.body.scrollTop,10)}this.mleft=parseInt(-1*(c.width/2+Number(g[3])),10);this.mtop=parseInt(-1*(c.height/2+Number(g[0])),10)+d;this.position=a;return this}})(jQuery);