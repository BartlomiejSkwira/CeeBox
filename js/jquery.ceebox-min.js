//ceebox
/*
 * CeeBox 2.0.4 BETA jQuery Plugin (minimized version)
 * Requires jQuery 1.3.2 and swfobject.jquery.js plugin to work
 * Code hosted on GitHub (http://github.com/catcubed/ceebox) Please visit there for version history information
 * By Colin Fahrion (http://www.catcubed.com)
 * Inspiration for ceebox comes from Thickbox (http://jquery.com/demo/thickbox/) and Videobox (http://videobox-lb.sourceforge.net/)
 * However, along the upgrade path ceebox has morphed a long way from those roots.
 * Copyright (c) 2009 Colin Fahrion
 * Licensed under the MIT License: http://www.opensource.org/licenses/mit-license.php
*/

(function(b){b.ceebox={version:"2.0.4"};b.fn.ceebox=function(a){a=b.extend({selector:b(this).selector},b.fn.ceebox.defaults,a);b(this).each(function(c){b.ceebox(this,c,a)});return this};b.fn.ceebox.defaults={html:true,image:true,video:true,modal:false,titles:true,htmlGallery:true,imageGallery:true,videoGallery:true,videoWidth:false,videoHeight:false,videoRatio:"16:9",htmlWidth:false,htmlHeight:false,htmlRatio:false,imageWidth:false,imageHeight:false,animSpeed:"normal",easing:"swing",fadeOut:400,fadeIn:400,
overlayColor:"#000",overlayOpacity:0.8,boxColor:"",textColor:"",borderColor:"",borderWidth:"3px",padding:15,margin:150,onload:null};b.fn.ceebox.ratios={"4:3":1.667,"3:2":1.5,"16:9":1.778,"1:1":1,square:1};b.fn.ceebox.relMatch={width:/\bwidth:[0-9]+\b/i,height:/\bheight:[0-9]+\b/i,modal:/\bmodal:true|false\b/i};b.fn.ceebox.loader="<div id='cee_load' style='z-index:105;top:50%;left:50%;position:fixed'></div>";b.ceebox=function(a,c,d){var e,f=[],g=0;b(a).is("a[href],area[href],input[href]")?(e=b(a)):
(e=b(a).children().andSelf().find("a[href],area[href],input[href]"));var l={image:function(i,k){return k.image&&i.match(/\.jpg$|\.jpeg$|\.png$|\.gif$|\.bmp$/i)||false},video:function(i,k){return k.video&&i.match(F)||false},html:function(i,k){return k.html}};e.each(function(i){var k=this,j=b.metadata?b.extend({},d,b(k).metadata()):d;j=b.simplemetadata?b.extend({},j,b(k).data("ceebox")):j;b.each(l,function(n){if(l[n](b(k).attr("href"),j)){var p=k;if(d.htmlGallery==true&&n=="html"){f[g]=i;g++}if(d.imageGallery==
true&&n=="image"){f[g]=i;g++}if(d.videoGallery==true&&n=="video"){f[g]=i;g++}b(p).unbind("click").bind("click",function(q){q.preventDefault();q.stopPropagation();b.fn.ceebox.overlay(j);if(n=="image"){var o=new Image;o.onload=function(){var w=o.width,y=o.height;j.imageWidth=r(w,b.fn.ceebox.defaults.imageWidth);j.imageHeight=r(y,b.fn.ceebox.defaults.imageHeight);j.imageRatio=w/y;b.fn.ceebox.popup(p,b.extend(j,{type:n}))};o.src=b(p).attr("href")}else b.fn.ceebox.popup(p,b.extend(j,{type:n}))});return false}})});
var m=f.length;b.each(f,function(i){var k=e[f[i]];if(m>1){var j={parentId:c,cbId:i,cbLen:m};if(i>0)j.prevId=f[i-1];if(i<m-1)j.nextId=f[i+1];b.data(k,"ceeboxGallery",j)}})};b.fn.ceebox.overlay=function(a){a=b.extend({width:60,height:30,type:"html"},b.fn.ceebox.defaults,a);b("#cee_overlay").size()==0&&b("<div id='cee_overlay'></div>").css({opacity:a.overlayOpacity,position:"absolute",top:0,left:0,backgroundColor:a.overlayColor,width:"100%",height:b(document).height(),zIndex:100}).appendTo(b("body"));
if(b("#cee_box").size()==0){var c=z(a);b("<div id='cee_box'></div>").css({position:c.position,zIndex:102,top:"50%",left:"50%",height:a.height+"px",width:a.width+"px",marginLeft:c.mleft+"px",marginTop:c.mtop+"px",opacity:0,borderWidth:a.borderWidth,borderColor:a.borderColor,backgroundColor:a.boxColor,color:a.textColor}).appendTo("body").animate({height:a.height+"px",width:a.width+"px",opacity:1},a.animSpeed,function(){b("#cee_overlay").one("click",function(){s(a)})})}b("#cee_box").removeClass().addClass("cee_"+
a.type);b("#cee_load").size()==0&&b(b.fn.ceebox.loader).appendTo("body").show("fast");b("#cee_load").show("fast").animate({opacity:1},"fast")};b.fn.ceebox.popup=function(a,c){c=b.extend({width:(new t(c.margin)).width,height:(new t(c.margin)).height,titleHeight:40,modal:false,type:"html",onload:null},b.fn.ceebox.defaults,c);var d,e;if(b(a).is("a,area,input")&&(c.type=="html"||c.type=="image"||c.type=="video")){if(d=b.data(a,"ceeboxGallery"))e=b(c.selector).eq(d.parentId).contents().andSelf().find("[href]");
A.prototype=new G[c.type](c);B[c.type].prototype=new A(a,c);var f=new B[c.type];a=f.content;c.action=f.action;c.modal=f.modal;if(c.titles){c.titleHeight=b(f.titlebox).contents().contents().wrap("<div></div>").parent().attr("id","ceetitletest").css({position:"absolute",top:"-300px",width:f.width+"px"}).appendTo("body").height();b("#ceetitletest").remove();c.titleHeight=c.titleHeight>=10?c.titleHeight+20:30}else c.titleHeight=0;c.width=f.width+2*c.padding;c.height=f.height+c.titleHeight+2*c.padding}b.fn.ceebox.overlay(c);
f=[];if(c.borderColor)f=C(c.borderColor);function g(){b("#cee_load").hide(300).fadeOut(600);u(c.action)&&c.action();u(c.onload)&&c.onload()}f=z(c);var l={marginLeft:f.mleft,marginTop:f.mtop,width:c.width+"px",height:c.height+"px",borderWidth:c.borderWidth};if(c.borderColor){f=C(c.borderColor);l=b.extend(l,{borderTopColor:f[0],borderRightColor:f[1],borderBottomColor:f[2],borderLeftColor:f[3]})}l=c.textColor?b.extend(l,{color:c.textColor}):l;l=c.backgroundColor?b.extend(l,{cbackgroundColor:c.boxColor}):
l;b("#cee_box").animate(l,c.animSpeed,c.easing,function(){var m=b(this).append(a).children().hide(),i=m.length;m.fadeIn(c.fadeIn,function(){if(b(this).is("iframe")){b(this).load(function(){g()});var k=true}!k&&this==m[i-1]&&g()});if(c.modal==true)b("#cee_overlay").unbind();else{b("<a href='#' id='cee_closeBtn' title='Close'>close</a>").prependTo("#cee_box").one("click",function(){s(c);return false});d&&H(d,e,c);I(d,e,c)}});b(".cee_close").live("click",function(m){m.preventDefault();b(".cee_close").die();
s(c);return false})};var G={image:function(a){this.width=a.imageWidth;this.height=a.imageHeight;this.ratio=a.imageRatio},video:function(a){this.width=a.videoWidth;this.height=a.videoHeight;this.ratio=a.videoRatio},html:function(a){this.width=a.htmlWidth;this.height=a.htmlHeight;this.ratio=a.htmlRatio}};function A(a,c){this.rel=b(a).attr("rel");this.href=b(a).attr("href");this.title=b(a).attr("title");this.titlebox=c.titles?"<div id='cee_title'><h2>"+this.title+"</h2></div>":"";this.margin=c.margin;
this.modal=c.modal;if((a=this.rel)&&a!=""){a=[a.match(b.fn.ceebox.relMatch.modal),a.match(b.fn.ceebox.relMatch.width),a.match(b.fn.ceebox.relMatch.height)];if(a[0])var d=String(a[0]).match(/true|false/i);if(d=="true")this.modal=true;if(d=="false")this.modal=false;if(a[1])this.width=Number(String(a[1]).match(/[0-9]+\b/));if(a[2])this.height=Number(String(a[2]).match(/[0-9]+\b/))}a=new t(this.margin);d=r(this.width,a.width);a=r(this.height,a.height);var e=this.ratio;if(e){if(!Number(e)){b.each(b.fn.ceebox.ratios,
function(f,g){if(e==f){e=g;return false}});e=Number(e)||1}if(d/a>e)d=parseInt(a*e,10);if(d/a<e)a=parseInt(d/e,10)}this.width=d;this.height=a}var B={image:function(){this.type="image";this.content="<img id='cee_img' src='"+this.href+"' width='"+this.width+"' height='"+this.height+"' alt='"+this.title+"'/>"+this.titlebox},video:function(){var a=String(String(this.href.match(/\w+\.com/i)).match(/\w+/i));if(D[a])E.prototype=new D[a];a=new E(this.href);J(a.src,"vidmatch prototype");var c=a.src,d=a.prm,
e=a.fvr,f=this.width,g=this.height;this.type="video";this.action=function(){b("#cee_vid").flash({swf:c,params:d,flashvars:e,width:f,height:g})};this.content="<div id='cee_vid' style='width:"+this.width+"px;height:"+this.height+"px'></div>"+this.titlebox},html:function(){var a=this.href,c=this.rel;c=[a.match(/\w+\.com/i),a.match(/^http:+/),c?c.match(/^iframe/):false];this.type="html";if(document.domain==c[0]&&c[1]&&!c[2]||!c[1]&&!c[2]){var d=a;if(a.match(/#[a-z_A-Z1-9]+/)){d=a.split("#")[0];d=String(d+
" "+a.match(/#[a-z_A-Z1-9\-]+/))}this.action=function(){b("#cee_ajax").load(d)};this.content=this.titlebox+"<div id='cee_ajax' style='width:"+(this.width-30)+"px;height:"+(this.height-20)+"px'></div>"}else{b("#cee_iframe").remove();this.content=this.titlebox+"<iframe frameborder='0' hspace='0' src='"+a+"' id='cee_iframeContent' name='cee_iframeContent"+Math.round(Math.random()*1000)+"'  style='width:"+this.width+"px;height:"+this.height+"px;' > </iframe>"}}},F=/youtube\.com\/watch|metacafe\.com\/watch|google\.com\/videoplay|ifilm\.com\/video|vimeo\.com|dailymotion\.com|facebook\.com\/video|\.swf$/i,
D={facebook:function(){this.src=["/v/",["v=",1,"&",0],""];this.prm={movie:this.src}},youtube:function(){this.src=["/v/",["v=",1,"&",0],"&hl=en&fs=1&autoplay=1"]},metacafe:function(){this.src=["/fplayer/",["id=",1,"&",0],"/.swf"]},google:function(){this.src=["/googleplayer.swf?docId=",["id=",1,"&",0],"&hl=en"];this.fvr={playerMode:"normal",fs:true}},ifilm:function(){this.src="/efp";this.prm=[h,"",["id=",1,"&",0],"&"]},vimeo:function(){this.src=["/moogaloop.swf?clip_id=",["/",3],"&server=vimeo.com&show_title=1&show_byline=1&show_portrait=0&color=&fullscreen=1"]},
dailymotion:function(){this.src=["/swf/",["/",4],"&related=0&autoplay=1"]}};function E(a){this.prm=b.extend({wmode:"transparent",allowFullScreen:"true",allowScriptAccess:"always"},this.prm);this.fvr=b.extend({autoplay:true},this.fvr);this.src=this.src||a;if(b.isArray(this.src)){var c=this.src,d=a,e=0,f=c[1].length;do{d=d.split(c[1][e])[c[1][e+1]];e+=2}while(e<f);this.src=String(a.match(/http:\/\/[a-zA-Z\.]+\.com/))+c[0]+d+c[2]}}function t(a){var c=document.documentElement;a=a||100;this.width=(window.innerWidth||
self.innerWidth||c&&c.clientWidth||document.body.clientWidth)-a;this.height=(window.innerHeight||self.innerHeight||c&&c.clientHeight||document.body.clientHeight)-a;this.ratio=this.width/this.height;return this}function z(a){var c="fixed",d=0,e,f,g=a.borderWidth.match(/[0-9]+/g);if(g.length=1)e=f=Number(g);else if(g.length=4){e=Number(g[0]);f=Number(g[3])}if(typeof document.body.style.maxHeight==="undefined"){b("#cee_HideSelect")===null&&b("body").append("<iframe id='cb.HideSelect'></iframe>");c="absolute";
d=parseInt(document.body.scrollTop,10)}this.mleft=parseInt(-1*(a.width/2+f),10)+d;this.mtop=parseInt(-1*(a.height/2+e),10);this.position=c;return this}function C(a){a=a.match(/#[1-90a-f]+/gi);if(a.length>1)a=[String(a[0]),String(a[1]),String(a[2]),String(a[3])];else{a=String(a);a=[a,a,a,a]}return a}function s(a){b("#cee_closeBtn").unbind();b("#cee_box").fadeOut(a.fadeOut,function(){b("#cee_box,#cee_overlay,#cee_HideSelect").unbind().trigger("unload").remove()});b("#cee_overlay").fadeOut(a.fadeOut*
2);b("#cee_load").remove();document.onkeydown=null;document.onkeyup=null;return false}function I(a,c,d){document.onkeydown=function(e){e=e||window.event;var f=e.keyCode||e.which;switch(f){case 27:s(d);document.onkeydown=null;break;case 188:case 37:a&&a.prevId!=null&&v(e,c,a.prevId,d);break;case 190:case 39:a&&a.nextId!=null&&v(e,c,a.nextId,d);break}}}function H(a,c,d){var e=parseInt(d.width/2),f=d.height-d.titleHeight-2*d.padding,g=d.padding,l=f/2;if(d.type=="video"||d.type=="html"){e=60;f=80;g=parseInt((d.height-
d.titleHeight-2*d.padding-10)/2);l=24}if(d.type=="html")g=parseInt((d.height-d.titleHeight-10)/2);function m(i,k){var j,n=l-2000+"px",p=l+"px";i=="prev"?(j=[{left:0},"left"]):(j=[{right:0},x="right"]);function q(o){return b.extend({width:e+"px",height:f+"px",position:"absolute",top:g},j[0],{backgroundPosition:j[1]+" "+o})}b("<a href='#'></a>").text(i).attr("id","cee_"+i).css(q(n)).hover(function(){b(this).css(q(p))},function(){b(this).css(q(n))}).one("click",function(o){v(o,c,k,d)}).appendTo("#cee_box")}
a.prevId!=null&&m("prev",a.prevId);a.nextId&&m("next",a.nextId);b("#cee_title").append("<div id='cee_count'>Item "+(a.cbId+1)+" of "+a.cbLen+"</div>")}function v(a,c,d,e){a.preventDefault();b("#cee_box").children().fadeOut(e.fadeOut,function(){b(this).remove();b(this).is("[id=cee_title]")&&c.eq(d).trigger("click")})}function r(a,c){return a&&a<c||!c?a:c}function K(a){return typeof a=="object"&&a||u(a)}function u(a){return typeof a=="function"}function J(a,c){if(debugging==true){var d="";c="[ceebox]("+
(c||"")+")";b.isArray(a)||K(a)?b.each(a,function(e,f){d=d+e+":"+f+", "}):(d=a);if(window.console&&window.console.log)window.console.log(c+d);else{b("#debug").size()==0&&b("<ul id='debug'></ul>").appendTo("body").css({border:"1px solid #ccf",position:"fixed",top:"10px",right:"10px",width:"300px",padding:"10px",listStyle:"square"});b("<li>").css({margin:"0 0 5px"}).appendTo("#debug").append(c).wrapInner("<b></b>").append(" "+d)}}}})(jQuery);